{"version":3,"sources":["optionsPage/node_modules/browser-pack/_prelude.js","optionsPage/optionsPage/index.js","optionsPage/utils/StorageManager.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","(function() {\r\n\t'use strict';\r\n\t/**\r\n\t * Shorthand function for querySelector\r\n\t * @param {string} el \r\n\t * @returns {HTMLElement} \r\n\t */\r\n\tconst DOM = elem => document.body.querySelector(elem);\r\n\tconst popoverDB = require(\"../utils/StorageManager\");\r\n\tconst MDCSnackbar = mdc.snackbar.MDCSnackbar;\r\n\tconst MDCSnackbarFoundation = mdc.snackbar.MDCSnackbarFoundation;\r\n\tmdc.snackbar.MDCSnackbar.attachTo(DOM('.mdc-snackbar'));\r\n\tconst snackbar = new MDCSnackbar(DOM('.mdc-snackbar'))\r\n\tvar shortcutSnapshot = '';\r\n\tvar keyGroup = {\r\n\t\tcodes: [],\r\n\t\tpressing: []\r\n\t};\r\n\r\n\tinitializer().DOMEvents()\r\n\tinitializer().elementsValues()\r\n\tinitializer().storageEvents()\r\n\r\n\r\n\r\n\t////////////////// IMPLEMENTATION //////////////////\r\n\r\n\tfunction initializer() {\r\n\r\n\t\t/**\r\n\t\t * Initializes DOM events listeners\r\n\t\t */\r\n\t\tfunction DOMEvents() {\r\n\t\t\tDOM('.js-popupShortcut').addEventListener('keydown', onKeyDown);\r\n\t\t\tDOM('.js-popupShortcut').addEventListener('keyup', onKeyUp);\r\n\t\t\tDOM('.js-popupShortcut').addEventListener('focus', onFocus);\r\n\t\t\tDOM('.js-popupShortcut').addEventListener('focusout', onFocusOut);\r\n\t\t\tDOM('.js-popupMode').addEventListener('change', savePopupMode);\r\n\t\t\tDOM('.js-fallbackLanguage').addEventListener('change', saveLanguage);\r\n\t\t\tDOM('.js-nlpLanguages').addEventListener('change', saveNlpLanguages);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Initializes DOM Elements values\r\n\t\t */\r\n\t\tfunction elementsValues() {\r\n\t\t\tsyncValues();\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Initializes storage changes listeners.\r\n\t\t */\r\n\t\tfunction storageEvents() {\r\n\t\t\tpopoverDB.onChanges(syncValues);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tDOMEvents,\r\n\t\t\telementsValues,\r\n\t\t\tstorageEvents\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tfunction onFocus(ev) {\r\n\t\tvar val = DOM('.js-popupShortcut').value;\r\n\t\tif (val) {\r\n\t\t\tshortcutSnapshot = val;\r\n\t\t}\r\n\t\tDOM('.js-popupShortcut').value = '';\r\n\t}\r\n\r\n\tfunction onFocusOut(ev) {\r\n\t\tif (DOM('.js-popupShortcut').value) {\r\n\t\t\tsaveShortcut();\r\n\t\t\tsnackbar.show({ message: 'Shortcut saved!' });\r\n\t\t} else {\r\n\t\t\tDOM('.js-popupShortcut').value = shortcutSnapshot;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onKeyDown(ev) {\r\n\t\tconsole.log(keyGroup.pressing);\r\n\t\tif (keyGroup.pressing.length === 0) {\r\n\t\t\tkeyGroup.codes = [];\r\n\t\t}\r\n\t\tif (keyGroup.codes.length < 3 && !keyGroup.codes.includes(ev.code)) {\r\n\t\t\tkeyGroup.pressing.push(ev.keyCode);\r\n\t\t\tkeyGroup.codes.push(ev.code);\r\n\t\t\tDOM('.js-popupShortcut').value = keyGroup.codes.toString();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onKeyUp(ev) {\r\n\t\tconsole.log(keyGroup.pressing);\r\n\t\tvar index = keyGroup.codes.indexOf(ev.code);\r\n\t\tif (index !== -1) {\r\n\t\t\tkeyGroup.pressing.splice(index, 1);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tasync function syncValues(oldV, newV) {\r\n\t\tvar fallbackLang = newV && newV['fallbackLang'] || await popoverDB.retrieve('fallbackLang');\r\n\t\tvar popupMode = newV && newV['popupMode'] || await popoverDB.retrieve('popupMode');\r\n\t\tvar nlpLangs = newV && newV['nlpLangs'] || await popoverDB.retrieve('nlpLangs');\r\n\t\tvar shortcut = newV && newV['shortcut'] || await popoverDB.retrieve('shortcut');\r\n\r\n\t\tDOM('.js-fallbackLanguage').value = fallbackLang;\r\n\t\tDOM('.js-popupMode').value = popupMode;\r\n\t\tDOM('.js-popupShortcut').value = shortcut.toString();\r\n\r\n\t\tvar checkboxList = document.body.querySelectorAll('.js-nlpLang');\r\n\t\tcheckboxList.forEach(chkbx => {\r\n\t\t\tif (nlpLangs.includes(chkbx.value)) {\r\n\t\t\t\tchkbx.checked = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction saveLanguage() {\r\n\t\tvar fallbackLanguage = DOM('.js-fallbackLanguage').value;\r\n\t\tpopoverDB.update('fallbackLang', fallbackLanguage).then(resp => {\r\n\t\t\tsnackbar.show({ message: ' ✔ Language definitions saved' });\r\n\t\t})\r\n\t}\r\n\r\n\tfunction savePopupMode() {\r\n\t\tvar popupMode = DOM('.js-popupMode').value;\r\n\t\tpopoverDB.update('popupMode', popupMode).then(resp => {\r\n\t\t\tsnackbar.show({ message: '✔ Popup trigger definitions saved' });\r\n\t\t});\r\n\t}\r\n\r\n\tfunction saveShortcut() {\r\n\t\tvar shortcut = keyGroup.codes;\r\n\t\tpopoverDB.update('shortcut', shortcut)\r\n\t\t\t.then(resp => {\r\n\t\t\t\tsnackbar.show({ message: '✔ Shortcut definitions saved' });\r\n\t\t\t});\r\n\t}\r\n\r\n\tfunction saveNlpLanguages() {\r\n\t\tvar languages = [];\r\n\t\tvar checkboxList = document.body.querySelectorAll('.js-nlpLang');\r\n\r\n\t\tcheckboxList.forEach(chkbx => {\r\n\t\t\tif (chkbx.checked) {\r\n\t\t\t\tlanguages.push(chkbx.value);\r\n\t\t\t}\r\n\t\t});\r\n\t\tpopoverDB.update('nlpLangs', languages).then(resp => {\r\n\t\t\tsnackbar.show({ message: '✔ Search Languages definitions saved' });\r\n\t\t});\r\n\t}\r\n}());","(() => {\r\n\t'use strict';\r\n\r\n\r\n\t/**\r\n\t * Manages and facilitate storage (chrome.storage.sync) requests and watchers.\r\n\t */\r\n\tclass PopoverDB {\r\n\r\n\t\tconstructor() {\r\n\t\t\tthis._errorCode = {\r\n\t\t\t\t1: key => `Object \"${key}\" not found`,\r\n\t\t\t\t2: (key, property) => `Object property \"${key}.${property}\" not found in storage.`,\r\n\t\t\t\t3: property => `Object property \".${property}\" not found in storage.`\r\n\t\t\t};\r\n\r\n\t\t\tthis._encodeProp = propertyName => {\r\n\r\n\t\t\t\tlet props = {\r\n\t\t\t\t\tisEnabled: 5,\r\n\t\t\t\t\tfallbackLang: 1,\r\n\t\t\t\t\tnlpLangs: 4,\r\n\t\t\t\t\tshortcut: 3,\r\n\t\t\t\t\tpopupMode: 2\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn props[propertyName];\r\n\t\t\t}\r\n\r\n\t\t\tthis._decodeProp = propertyName => {\r\n\r\n\t\t\t\tlet props = {\r\n\t\t\t\t\t5: 'isEnabled',\r\n\t\t\t\t\t1: 'fallbackLang',\r\n\t\t\t\t\t4: 'nlpLangs',\r\n\t\t\t\t\t3: 'shortcut',\r\n\t\t\t\t\t2: 'popupMode'\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn props[propertyName];\r\n\t\t\t}\r\n\r\n\t\t\tthis._decodeObj = obj => {\r\n\t\t\t\tlet decodedObj = {};\r\n\t\t\t\tObject.keys(obj).forEach(key => {\r\n\t\t\t\t\tdecodedObj[this._decodeProp(key)] = obj[key];\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn decodedObj;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tupdate(property, value) {\r\n\t\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\t\tvar dataString = '';\r\n\t\t\t\tvar data = await this.retrieve();\r\n\r\n\t\t\t\tdata[this._encodeProp(property)] = value;\r\n\t\t\t\tdataString = JSON.stringify(data);\r\n\r\n\t\t\t\tchrome.storage.sync.set({\r\n\t\t\t\t\twldt: dataString\r\n\t\t\t\t}, () => resolve(true));\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tretrieve(property = '') {\r\n\t\t\tvar errorCount = 0;\r\n\t\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\t\tvar dataString = '';\r\n\t\t\t\ttry {\r\n\t\t\t\t\tdataString = await new Promise(resolve => chrome.storage.sync.get('wldt', obj => resolve(obj['wldt'])));\r\n\t\t\t\t\tvar data = JSON.parse(dataString);\r\n\r\n\t\t\t\t\tif (property.length > 0)\r\n\t\t\t\t\t\tresolve(data[this._encodeProp(property)])\r\n\t\t\t\t\telse resolve(data);\r\n\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\terrorCount += 1;\r\n\t\t\t\t\tif (errorCount >= 2) {\r\n\t\t\t\t\t\treject(error);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet wikilinkData = JSON.stringify({\r\n\t\t\t\t\t\t\t1: 'en',\r\n\t\t\t\t\t\t\t2: 'shortcut',\r\n\t\t\t\t\t\t\t3: ['ShiftLeft', 'AltLeft'],\r\n\t\t\t\t\t\t\t4: ['por', 'eng', 'esp', 'rus'],\r\n\t\t\t\t\t\t\t5: true\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tchrome.storage.sync.set({ wldt: wikilinkData }, () => this.retrieve(property));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\t\t}\r\n\r\n\r\n\t\t/**\r\n\t\t * Listens to storage changes in given object and executes a function in a onChanged event.\r\n\t\t * @param {*} objName The name of the object in the storage to listens.\r\n\t\t * @returns {object} A function to pass as an argument the function to execute on event.\r\n\t\t */\r\n\t\tonChanges(fn) {\r\n\r\n\t\t\tvar decodedObj = this._decodeObj;\r\n\r\n\t\t\tchrome.storage.onChanged.addListener((changes, areaName) => {\r\n\t\t\t\t//Popover enabled state changed\r\n\t\t\t\tif (changes['wldt']) {\r\n\t\t\t\t\tfn(decodedObj(JSON.parse(changes['wldt'].oldValue)), decodedObj(JSON.parse(changes['wldt'].newValue)));\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tmodule.exports = new PopoverDB();\r\n\r\n})();"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJvcHRpb25zUGFnZS9pbmRleC5qcyIsInV0aWxzL1N0b3JhZ2VNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiKGZ1bmN0aW9uKCkge1xyXG5cdCd1c2Ugc3RyaWN0JztcclxuXHQvKipcclxuXHQgKiBTaG9ydGhhbmQgZnVuY3Rpb24gZm9yIHF1ZXJ5U2VsZWN0b3JcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gZWwgXHJcblx0ICogQHJldHVybnMge0hUTUxFbGVtZW50fSBcclxuXHQgKi9cclxuXHRjb25zdCBET00gPSBlbGVtID0+IGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvcihlbGVtKTtcclxuXHRjb25zdCBwb3BvdmVyREIgPSByZXF1aXJlKFwiLi4vdXRpbHMvU3RvcmFnZU1hbmFnZXJcIik7XHJcblx0Y29uc3QgTURDU25hY2tiYXIgPSBtZGMuc25hY2tiYXIuTURDU25hY2tiYXI7XHJcblx0Y29uc3QgTURDU25hY2tiYXJGb3VuZGF0aW9uID0gbWRjLnNuYWNrYmFyLk1EQ1NuYWNrYmFyRm91bmRhdGlvbjtcclxuXHRtZGMuc25hY2tiYXIuTURDU25hY2tiYXIuYXR0YWNoVG8oRE9NKCcubWRjLXNuYWNrYmFyJykpO1xyXG5cdGNvbnN0IHNuYWNrYmFyID0gbmV3IE1EQ1NuYWNrYmFyKERPTSgnLm1kYy1zbmFja2JhcicpKVxyXG5cdHZhciBzaG9ydGN1dFNuYXBzaG90ID0gJyc7XHJcblx0dmFyIGtleUdyb3VwID0ge1xyXG5cdFx0Y29kZXM6IFtdLFxyXG5cdFx0cHJlc3Npbmc6IFtdXHJcblx0fTtcclxuXHJcblx0aW5pdGlhbGl6ZXIoKS5ET01FdmVudHMoKVxyXG5cdGluaXRpYWxpemVyKCkuZWxlbWVudHNWYWx1ZXMoKVxyXG5cdGluaXRpYWxpemVyKCkuc3RvcmFnZUV2ZW50cygpXHJcblxyXG5cclxuXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vIElNUExFTUVOVEFUSU9OIC8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHRmdW5jdGlvbiBpbml0aWFsaXplcigpIHtcclxuXHJcblx0XHQvKipcclxuXHRcdCAqIEluaXRpYWxpemVzIERPTSBldmVudHMgbGlzdGVuZXJzXHJcblx0XHQgKi9cclxuXHRcdGZ1bmN0aW9uIERPTUV2ZW50cygpIHtcclxuXHRcdFx0RE9NKCcuanMtcG9wdXBTaG9ydGN1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbktleURvd24pO1xyXG5cdFx0XHRET00oJy5qcy1wb3B1cFNob3J0Y3V0JykuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBvbktleVVwKTtcclxuXHRcdFx0RE9NKCcuanMtcG9wdXBTaG9ydGN1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgb25Gb2N1cyk7XHJcblx0XHRcdERPTSgnLmpzLXBvcHVwU2hvcnRjdXQnKS5hZGRFdmVudExpc3RlbmVyKCdmb2N1c291dCcsIG9uRm9jdXNPdXQpO1xyXG5cdFx0XHRET00oJy5qcy1wb3B1cE1vZGUnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzYXZlUG9wdXBNb2RlKTtcclxuXHRcdFx0RE9NKCcuanMtZmFsbGJhY2tMYW5ndWFnZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHNhdmVMYW5ndWFnZSk7XHJcblx0XHRcdERPTSgnLmpzLW5scExhbmd1YWdlcycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHNhdmVObHBMYW5ndWFnZXMpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8qKlxyXG5cdFx0ICogSW5pdGlhbGl6ZXMgRE9NIEVsZW1lbnRzIHZhbHVlc1xyXG5cdFx0ICovXHJcblx0XHRmdW5jdGlvbiBlbGVtZW50c1ZhbHVlcygpIHtcclxuXHRcdFx0c3luY1ZhbHVlcygpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8qKlxyXG5cdFx0ICogSW5pdGlhbGl6ZXMgc3RvcmFnZSBjaGFuZ2VzIGxpc3RlbmVycy5cclxuXHRcdCAqL1xyXG5cdFx0ZnVuY3Rpb24gc3RvcmFnZUV2ZW50cygpIHtcclxuXHRcdFx0cG9wb3ZlckRCLm9uQ2hhbmdlcyhzeW5jVmFsdWVzKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRET01FdmVudHMsXHJcblx0XHRcdGVsZW1lbnRzVmFsdWVzLFxyXG5cdFx0XHRzdG9yYWdlRXZlbnRzXHJcblx0XHR9O1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIG9uRm9jdXMoZXYpIHtcclxuXHRcdHZhciB2YWwgPSBET00oJy5qcy1wb3B1cFNob3J0Y3V0JykudmFsdWU7XHJcblx0XHRpZiAodmFsKSB7XHJcblx0XHRcdHNob3J0Y3V0U25hcHNob3QgPSB2YWw7XHJcblx0XHR9XHJcblx0XHRET00oJy5qcy1wb3B1cFNob3J0Y3V0JykudmFsdWUgPSAnJztcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIG9uRm9jdXNPdXQoZXYpIHtcclxuXHRcdGlmIChET00oJy5qcy1wb3B1cFNob3J0Y3V0JykudmFsdWUpIHtcclxuXHRcdFx0c2F2ZVNob3J0Y3V0KCk7XHJcblx0XHRcdHNuYWNrYmFyLnNob3coeyBtZXNzYWdlOiAnU2hvcnRjdXQgc2F2ZWQhJyB9KTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdERPTSgnLmpzLXBvcHVwU2hvcnRjdXQnKS52YWx1ZSA9IHNob3J0Y3V0U25hcHNob3Q7XHJcblx0XHR9XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gb25LZXlEb3duKGV2KSB7XHJcblx0XHRjb25zb2xlLmxvZyhrZXlHcm91cC5wcmVzc2luZyk7XHJcblx0XHRpZiAoa2V5R3JvdXAucHJlc3NpbmcubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdGtleUdyb3VwLmNvZGVzID0gW107XHJcblx0XHR9XHJcblx0XHRpZiAoa2V5R3JvdXAuY29kZXMubGVuZ3RoIDwgMyAmJiAha2V5R3JvdXAuY29kZXMuaW5jbHVkZXMoZXYuY29kZSkpIHtcclxuXHRcdFx0a2V5R3JvdXAucHJlc3NpbmcucHVzaChldi5rZXlDb2RlKTtcclxuXHRcdFx0a2V5R3JvdXAuY29kZXMucHVzaChldi5jb2RlKTtcclxuXHRcdFx0RE9NKCcuanMtcG9wdXBTaG9ydGN1dCcpLnZhbHVlID0ga2V5R3JvdXAuY29kZXMudG9TdHJpbmcoKTtcclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBvbktleVVwKGV2KSB7XHJcblx0XHRjb25zb2xlLmxvZyhrZXlHcm91cC5wcmVzc2luZyk7XHJcblx0XHR2YXIgaW5kZXggPSBrZXlHcm91cC5jb2Rlcy5pbmRleE9mKGV2LmNvZGUpO1xyXG5cdFx0aWYgKGluZGV4ICE9PSAtMSkge1xyXG5cdFx0XHRrZXlHcm91cC5wcmVzc2luZy5zcGxpY2UoaW5kZXgsIDEpO1xyXG5cdFx0fVxyXG5cclxuXHR9XHJcblxyXG5cdGFzeW5jIGZ1bmN0aW9uIHN5bmNWYWx1ZXMob2xkViwgbmV3Vikge1xyXG5cdFx0dmFyIGZhbGxiYWNrTGFuZyA9IG5ld1YgJiYgbmV3VlsnZmFsbGJhY2tMYW5nJ10gfHwgYXdhaXQgcG9wb3ZlckRCLnJldHJpZXZlKCdmYWxsYmFja0xhbmcnKTtcclxuXHRcdHZhciBwb3B1cE1vZGUgPSBuZXdWICYmIG5ld1ZbJ3BvcHVwTW9kZSddIHx8IGF3YWl0IHBvcG92ZXJEQi5yZXRyaWV2ZSgncG9wdXBNb2RlJyk7XHJcblx0XHR2YXIgbmxwTGFuZ3MgPSBuZXdWICYmIG5ld1ZbJ25scExhbmdzJ10gfHwgYXdhaXQgcG9wb3ZlckRCLnJldHJpZXZlKCdubHBMYW5ncycpO1xyXG5cdFx0dmFyIHNob3J0Y3V0ID0gbmV3ViAmJiBuZXdWWydzaG9ydGN1dCddIHx8IGF3YWl0IHBvcG92ZXJEQi5yZXRyaWV2ZSgnc2hvcnRjdXQnKTtcclxuXHJcblx0XHRET00oJy5qcy1mYWxsYmFja0xhbmd1YWdlJykudmFsdWUgPSBmYWxsYmFja0xhbmc7XHJcblx0XHRET00oJy5qcy1wb3B1cE1vZGUnKS52YWx1ZSA9IHBvcHVwTW9kZTtcclxuXHRcdERPTSgnLmpzLXBvcHVwU2hvcnRjdXQnKS52YWx1ZSA9IHNob3J0Y3V0LnRvU3RyaW5nKCk7XHJcblxyXG5cdFx0dmFyIGNoZWNrYm94TGlzdCA9IGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvckFsbCgnLmpzLW5scExhbmcnKTtcclxuXHRcdGNoZWNrYm94TGlzdC5mb3JFYWNoKGNoa2J4ID0+IHtcclxuXHRcdFx0aWYgKG5scExhbmdzLmluY2x1ZGVzKGNoa2J4LnZhbHVlKSkge1xyXG5cdFx0XHRcdGNoa2J4LmNoZWNrZWQgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHNhdmVMYW5ndWFnZSgpIHtcclxuXHRcdHZhciBmYWxsYmFja0xhbmd1YWdlID0gRE9NKCcuanMtZmFsbGJhY2tMYW5ndWFnZScpLnZhbHVlO1xyXG5cdFx0cG9wb3ZlckRCLnVwZGF0ZSgnZmFsbGJhY2tMYW5nJywgZmFsbGJhY2tMYW5ndWFnZSkudGhlbihyZXNwID0+IHtcclxuXHRcdFx0c25hY2tiYXIuc2hvdyh7IG1lc3NhZ2U6ICcg4pyUIExhbmd1YWdlIGRlZmluaXRpb25zIHNhdmVkJyB9KTtcclxuXHRcdH0pXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzYXZlUG9wdXBNb2RlKCkge1xyXG5cdFx0dmFyIHBvcHVwTW9kZSA9IERPTSgnLmpzLXBvcHVwTW9kZScpLnZhbHVlO1xyXG5cdFx0cG9wb3ZlckRCLnVwZGF0ZSgncG9wdXBNb2RlJywgcG9wdXBNb2RlKS50aGVuKHJlc3AgPT4ge1xyXG5cdFx0XHRzbmFja2Jhci5zaG93KHsgbWVzc2FnZTogJ+KclCBQb3B1cCB0cmlnZ2VyIGRlZmluaXRpb25zIHNhdmVkJyB9KTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc2F2ZVNob3J0Y3V0KCkge1xyXG5cdFx0dmFyIHNob3J0Y3V0ID0ga2V5R3JvdXAuY29kZXM7XHJcblx0XHRwb3BvdmVyREIudXBkYXRlKCdzaG9ydGN1dCcsIHNob3J0Y3V0KVxyXG5cdFx0XHQudGhlbihyZXNwID0+IHtcclxuXHRcdFx0XHRzbmFja2Jhci5zaG93KHsgbWVzc2FnZTogJ+KclCBTaG9ydGN1dCBkZWZpbml0aW9ucyBzYXZlZCcgfSk7XHJcblx0XHRcdH0pO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc2F2ZU5scExhbmd1YWdlcygpIHtcclxuXHRcdHZhciBsYW5ndWFnZXMgPSBbXTtcclxuXHRcdHZhciBjaGVja2JveExpc3QgPSBkb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3JBbGwoJy5qcy1ubHBMYW5nJyk7XHJcblxyXG5cdFx0Y2hlY2tib3hMaXN0LmZvckVhY2goY2hrYnggPT4ge1xyXG5cdFx0XHRpZiAoY2hrYnguY2hlY2tlZCkge1xyXG5cdFx0XHRcdGxhbmd1YWdlcy5wdXNoKGNoa2J4LnZhbHVlKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0XHRwb3BvdmVyREIudXBkYXRlKCdubHBMYW5ncycsIGxhbmd1YWdlcykudGhlbihyZXNwID0+IHtcclxuXHRcdFx0c25hY2tiYXIuc2hvdyh7IG1lc3NhZ2U6ICfinJQgU2VhcmNoIExhbmd1YWdlcyBkZWZpbml0aW9ucyBzYXZlZCcgfSk7XHJcblx0XHR9KTtcclxuXHR9XHJcbn0oKSk7IiwiKCgpID0+IHtcclxuXHQndXNlIHN0cmljdCc7XHJcblxyXG5cclxuXHQvKipcclxuXHQgKiBNYW5hZ2VzIGFuZCBmYWNpbGl0YXRlIHN0b3JhZ2UgKGNocm9tZS5zdG9yYWdlLnN5bmMpIHJlcXVlc3RzIGFuZCB3YXRjaGVycy5cclxuXHQgKi9cclxuXHRjbGFzcyBQb3BvdmVyREIge1xyXG5cclxuXHRcdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0XHR0aGlzLl9lcnJvckNvZGUgPSB7XHJcblx0XHRcdFx0MToga2V5ID0+IGBPYmplY3QgXCIke2tleX1cIiBub3QgZm91bmRgLFxyXG5cdFx0XHRcdDI6IChrZXksIHByb3BlcnR5KSA9PiBgT2JqZWN0IHByb3BlcnR5IFwiJHtrZXl9LiR7cHJvcGVydHl9XCIgbm90IGZvdW5kIGluIHN0b3JhZ2UuYCxcclxuXHRcdFx0XHQzOiBwcm9wZXJ0eSA9PiBgT2JqZWN0IHByb3BlcnR5IFwiLiR7cHJvcGVydHl9XCIgbm90IGZvdW5kIGluIHN0b3JhZ2UuYFxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0dGhpcy5fZW5jb2RlUHJvcCA9IHByb3BlcnR5TmFtZSA9PiB7XHJcblxyXG5cdFx0XHRcdGxldCBwcm9wcyA9IHtcclxuXHRcdFx0XHRcdGlzRW5hYmxlZDogNSxcclxuXHRcdFx0XHRcdGZhbGxiYWNrTGFuZzogMSxcclxuXHRcdFx0XHRcdG5scExhbmdzOiA0LFxyXG5cdFx0XHRcdFx0c2hvcnRjdXQ6IDMsXHJcblx0XHRcdFx0XHRwb3B1cE1vZGU6IDJcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHJldHVybiBwcm9wc1twcm9wZXJ0eU5hbWVdO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLl9kZWNvZGVQcm9wID0gcHJvcGVydHlOYW1lID0+IHtcclxuXHJcblx0XHRcdFx0bGV0IHByb3BzID0ge1xyXG5cdFx0XHRcdFx0NTogJ2lzRW5hYmxlZCcsXHJcblx0XHRcdFx0XHQxOiAnZmFsbGJhY2tMYW5nJyxcclxuXHRcdFx0XHRcdDQ6ICdubHBMYW5ncycsXHJcblx0XHRcdFx0XHQzOiAnc2hvcnRjdXQnLFxyXG5cdFx0XHRcdFx0MjogJ3BvcHVwTW9kZSdcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHJldHVybiBwcm9wc1twcm9wZXJ0eU5hbWVdO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLl9kZWNvZGVPYmogPSBvYmogPT4ge1xyXG5cdFx0XHRcdGxldCBkZWNvZGVkT2JqID0ge307XHJcblx0XHRcdFx0T2JqZWN0LmtleXMob2JqKS5mb3JFYWNoKGtleSA9PiB7XHJcblx0XHRcdFx0XHRkZWNvZGVkT2JqW3RoaXMuX2RlY29kZVByb3Aoa2V5KV0gPSBvYmpba2V5XTtcclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0cmV0dXJuIGRlY29kZWRPYmo7XHJcblx0XHRcdH1cclxuXHJcblx0XHR9XHJcblxyXG5cdFx0dXBkYXRlKHByb3BlcnR5LCB2YWx1ZSkge1xyXG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cdFx0XHRcdHZhciBkYXRhU3RyaW5nID0gJyc7XHJcblx0XHRcdFx0dmFyIGRhdGEgPSBhd2FpdCB0aGlzLnJldHJpZXZlKCk7XHJcblxyXG5cdFx0XHRcdGRhdGFbdGhpcy5fZW5jb2RlUHJvcChwcm9wZXJ0eSldID0gdmFsdWU7XHJcblx0XHRcdFx0ZGF0YVN0cmluZyA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xyXG5cclxuXHRcdFx0XHRjaHJvbWUuc3RvcmFnZS5zeW5jLnNldCh7XHJcblx0XHRcdFx0XHR3bGR0OiBkYXRhU3RyaW5nXHJcblx0XHRcdFx0fSwgKCkgPT4gcmVzb2x2ZSh0cnVlKSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHJpZXZlKHByb3BlcnR5ID0gJycpIHtcclxuXHRcdFx0dmFyIGVycm9yQ291bnQgPSAwO1xyXG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cdFx0XHRcdHZhciBkYXRhU3RyaW5nID0gJyc7XHJcblx0XHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRcdGRhdGFTdHJpbmcgPSBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IGNocm9tZS5zdG9yYWdlLnN5bmMuZ2V0KCd3bGR0Jywgb2JqID0+IHJlc29sdmUob2JqWyd3bGR0J10pKSk7XHJcblx0XHRcdFx0XHR2YXIgZGF0YSA9IEpTT04ucGFyc2UoZGF0YVN0cmluZyk7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHByb3BlcnR5Lmxlbmd0aCA+IDApXHJcblx0XHRcdFx0XHRcdHJlc29sdmUoZGF0YVt0aGlzLl9lbmNvZGVQcm9wKHByb3BlcnR5KV0pXHJcblx0XHRcdFx0XHRlbHNlIHJlc29sdmUoZGF0YSk7XHJcblxyXG5cdFx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XHJcblx0XHRcdFx0XHRlcnJvckNvdW50ICs9IDE7XHJcblx0XHRcdFx0XHRpZiAoZXJyb3JDb3VudCA+PSAyKSB7XHJcblx0XHRcdFx0XHRcdHJlamVjdChlcnJvcik7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRsZXQgd2lraWxpbmtEYXRhID0gSlNPTi5zdHJpbmdpZnkoe1xyXG5cdFx0XHRcdFx0XHRcdDE6ICdlbicsXHJcblx0XHRcdFx0XHRcdFx0MjogJ3Nob3J0Y3V0JyxcclxuXHRcdFx0XHRcdFx0XHQzOiBbJ1NoaWZ0TGVmdCcsICdBbHRMZWZ0J10sXHJcblx0XHRcdFx0XHRcdFx0NDogWydwb3InLCAnZW5nJywgJ2VzcCcsICdydXMnXSxcclxuXHRcdFx0XHRcdFx0XHQ1OiB0cnVlXHJcblx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRjaHJvbWUuc3RvcmFnZS5zeW5jLnNldCh7IHdsZHQ6IHdpa2lsaW5rRGF0YSB9LCAoKSA9PiB0aGlzLnJldHJpZXZlKHByb3BlcnR5KSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cclxuXHRcdC8qKlxyXG5cdFx0ICogTGlzdGVucyB0byBzdG9yYWdlIGNoYW5nZXMgaW4gZ2l2ZW4gb2JqZWN0IGFuZCBleGVjdXRlcyBhIGZ1bmN0aW9uIGluIGEgb25DaGFuZ2VkIGV2ZW50LlxyXG5cdFx0ICogQHBhcmFtIHsqfSBvYmpOYW1lIFRoZSBuYW1lIG9mIHRoZSBvYmplY3QgaW4gdGhlIHN0b3JhZ2UgdG8gbGlzdGVucy5cclxuXHRcdCAqIEByZXR1cm5zIHtvYmplY3R9IEEgZnVuY3Rpb24gdG8gcGFzcyBhcyBhbiBhcmd1bWVudCB0aGUgZnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBldmVudC5cclxuXHRcdCAqL1xyXG5cdFx0b25DaGFuZ2VzKGZuKSB7XHJcblxyXG5cdFx0XHR2YXIgZGVjb2RlZE9iaiA9IHRoaXMuX2RlY29kZU9iajtcclxuXHJcblx0XHRcdGNocm9tZS5zdG9yYWdlLm9uQ2hhbmdlZC5hZGRMaXN0ZW5lcigoY2hhbmdlcywgYXJlYU5hbWUpID0+IHtcclxuXHRcdFx0XHQvL1BvcG92ZXIgZW5hYmxlZCBzdGF0ZSBjaGFuZ2VkXHJcblx0XHRcdFx0aWYgKGNoYW5nZXNbJ3dsZHQnXSkge1xyXG5cdFx0XHRcdFx0Zm4oZGVjb2RlZE9iaihKU09OLnBhcnNlKGNoYW5nZXNbJ3dsZHQnXS5vbGRWYWx1ZSkpLCBkZWNvZGVkT2JqKEpTT04ucGFyc2UoY2hhbmdlc1snd2xkdCddLm5ld1ZhbHVlKSkpO1xyXG5cdFx0XHRcdH07XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0bW9kdWxlLmV4cG9ydHMgPSBuZXcgUG9wb3ZlckRCKCk7XHJcblxyXG59KSgpOyJdfQ=="}